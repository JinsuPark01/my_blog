# Clerk를 활용한 인증 시스템 기술 아키텍처 설계서

## 1. Clerk 통합 다이어그램

### 클라이언트와 서버 간 인증 흐름
- 클라이언트는 ClerkProvider를 통해 인증 상태를 관리
- 서버는 Clerk의 API를 사용하여 세션 및 토큰을 검증
- 인증된 사용자는 세션 토큰을 통해 API 요청 수행

### 세션 및 토큰 관리 방식
- Clerk는 세션 토큰을 자동으로 관리하며, 클라이언트와 서버 간 안전한 통신을 보장
- 세션 만료 시 자동 로그아웃 처리

## 2. 주요 구현 컴포넌트

### ClerkProvider 설정
- ClerkProvider를 `app/layout.tsx`에 추가하여 모든 페이지에서 인증 상태를 공유

### 미들웨어 구성
- 모든 페이지는 기본적으로 공개 접근 가능
- API 라우트는 인증된 사용자만 접근 가능하도록 보호

### 인증 상태에 따른 UI 조건부 렌더링
- 로그인 상태에 따라 헤더에 사용자 프로필 또는 로그인 버튼 표시
- 댓글 작성 버튼은 인증된 사용자만 활성화

## 3. 권한 검증 전략

### 댓글 작성 기능에 대한 인증 확인 방법
- 댓글 작성 API 호출 시 세션 토큰을 검증하여 인증된 사용자만 댓글 작성 가능

### 관리자 기능 접근 제어 방법
- 관리자 역할을 가진 사용자만 특정 API 및 페이지에 접근 가능
- 역할 기반 접근 제어를 위한 Clerk의 사용자 메타데이터 활용

## 4. 폴더 및 파일 구조

### auth 관련 컴포넌트 위치
- `components/auth/` 폴더에 인증 관련 UI 컴포넌트 배치

### 미들웨어 설정 파일
- `lib/middleware.ts`에 Clerk 미들웨어 구성

### 유틸리티 함수 구성
- `lib/auth-utils.ts`에 인증 및 권한 검증 관련 유틸리티 함수 작성

## 완료 기준
- 전체 인증 아키텍처가 명확히 정의됨
- Next.js App Router와 호환되는 구조
- 코드 스니펫과 설명이 포함됨
